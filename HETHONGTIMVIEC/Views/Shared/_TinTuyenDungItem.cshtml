@model HeThongTimViec.ViewModels.TimViec.KetQuaTimViecItemViewModel
@inject Microsoft.AspNetCore.Antiforgery.IAntiforgery antiforgery
@{
    var userIsAuthenticated = User.Identity?.IsAuthenticated ?? false;
    var truncatedTitle = Model.TieuDe.Length > 80 ? Model.TieuDe.Substring(0, 80) + "..." : Model.TieuDe;
}

<div class="card job-item mb-3 shadow-sm @(Model.TinGap ? "border-danger border-2" : "border-light")">
    <div class="row g-0">
        <div class="col-md-2 d-flex align-items-center justify-content-center p-2 bg-light">
            <a asp-action="ChiTiet" asp-controller="TimViec" asp-route-id="@Model.Id" class="text-decoration-none">
                <img src="@(!string.IsNullOrEmpty(Model.LogoHoacAvatarUrl) ? Model.LogoHoacAvatarUrl : "/images/default-placeholder.png")"
                     class="img-fluid rounded"
                     alt="Logo/Avatar @Model.TenCongTyHoacNguoiDang"
                     style="max-width: 100px; max-height: 100px; object-fit: contain;"
                     onerror="this.onerror=null; this.src='/images/default-placeholder.png';"> @* Fallback nếu link ảnh lỗi *@
            </a>
        </div>
        <div class="col-md-10">
            <div class="card-body position-relative pb-5"> @* Thêm padding bottom để ngày đăng không bị che *@
                <div class="d-flex justify-content-between align-items-start mb-2">
                    <div>
                        <h5 class="card-title mb-1 fs-6 fw-bold">
                            @* Link bao quanh tiêu đề, nút bấm sẽ nằm đè lên với z-index cao hơn *@
                            <a asp-action="ChiTiet" asp-controller="TimViec" asp-route-id="@Model.Id" class="text-decoration-none stretched-link text-dark job-title-link" title="@Model.TieuDe">
                                @truncatedTitle
                            </a>
                            @if (Model.TinGap)
                            {
                                <span class="badge bg-danger ms-1" style="font-size: 0.7em;">Gấp</span>
                            }
                        </h5>
                        <p class="card-text mb-1 text-muted small">
                             <i class="fas fa-building me-1"></i> @Model.TenCongTyHoacNguoiDang
                        </p>
                    </div>
                     @* Nút Lưu/Bỏ Lưu - Đặt z-index cao hơn stretched-link *@
                    <div class="job-actions text-end position-absolute top-0 end-0 pt-2 pe-2" style="z-index: 10;">
                        @if (userIsAuthenticated)
                        {
                            if (Model.DaLuu)
                            {
                                <button class="btn btn-sm btn-success btn-unsave-job rounded-circle p-2 lh-1" data-id="@Model.Id" title="Bỏ lưu tin này">
                                    <i class="fas fa-heart fa-fw"></i>
                                </button>
                            }
                            else
                            {
                                <button class="btn btn-sm btn-outline-success btn-save-job rounded-circle p-2 lh-1" data-id="@Model.Id" title="Lưu tin này">
                                    <i class="far fa-heart fa-fw"></i>
                                </button>
                            }
                        }
                        else
                        {
                            <a asp-controller="Account" asp-action="Login" asp-route-returnUrl="@(Context.Request.Path + Context.Request.QueryString)"
                               class="btn btn-sm btn-outline-secondary rounded-circle p-2 lh-1" title="Đăng nhập để lưu tin">
                                <i class="far fa-heart fa-fw"></i>
                            </a>
                        }
                    </div>
                </div>

                @* Thông tin chi tiết hơn *@
                <div class="row gx-2 gy-1 mb-2 small text-muted">
                     <div class="col-sm-6 col-lg-4">
                        <i class="fas fa-map-marker-alt fa-fw me-1 text-danger"></i>@Model.DiaDiem
                     </div>
                     <div class="col-sm-6 col-lg-4">
                         <i class="fas fa-briefcase fa-fw me-1 text-primary"></i>@Model.LoaiHinhCongViecDisplay
                     </div>
                      <div class="col-sm-6 col-lg-4">
                         <i class="fas fa-dollar-sign fa-fw me-1 text-success"></i><span class="fw-semibold">@Model.MucLuongDisplay</span>
                     </div>
                     @if (Model.NganhNgheNho.Any())
                     {
                          <div class="col-12">
                               <i class="fas fa-tags fa-fw me-1 text-secondary"></i>
                               @string.Join(", ", Model.NganhNgheNho)
                           </div>
                     }
                </div>

                @* Ngày đăng ở góc dưới *@
                 <div class="position-absolute bottom-0 end-0 pb-2 pe-2">
                     <small class="text-muted" style="font-size: 0.8em;">
                         <i class="far fa-clock me-1"></i>@Model.NgayDang.ToString("dd/MM/yyyy")
                     </small>
                 </div>
            </div>
        </div>
    </div>
</div>

<style>
/* Đảm bảo nút bấm được ưu tiên hơn link tiêu đề */
.job-actions button, .job-actions a {
    position: relative; /* Cần để z-index hoạt động */
    z-index: 10; /* Cao hơn z-index mặc định của stretched-link */
}
.job-title-link {
     color: #212529; /* Màu tối mặc định */
     transition: color 0.2s ease-in-out;
}
.job-title-link:hover {
    color: #0d6efd; /* Màu xanh khi hover */
}

/* Style cho nút lưu hình tròn */
.rounded-circle.p-2 {
    width: 32px; /* Đặt kích thước cố định */
    height: 32px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
}
</style>